<html>
<head>
    <meta charset="utf-8">
    <title>Mocha Tests</title>
    <link rel="stylesheet" href="http://nathansuniversity.com/css/mocha.css" />
    <script src="http://nathansuniversity.com/js/jquery-1.7.1.min.js"></script>
    <script src="http://nathansuniversity.com/js/chai.js"></script>
    <script src="http://nathansuniversity.com/js/mocha.js"></script>
    <script>mocha.setup('tdd')</script>
    <!-- my Scheem interpreter -->
    <script src="./scheem.js"></script>
    <script>
var assert = chai.assert;

// Some unit tests

suite('add', function() {
    test('two plus two', function() {
        assert.deepEqual(
            scheem.eval(['+', 2, 2], {}),
            4
        );
    });
    test('two numbers', function() {
        assert.deepEqual(
            scheem.eval(['+', 3, 5], {}),
            8
        );
    });
    test('a number and an expression', function() {
        assert.deepEqual(
            scheem.eval(['+', 3, ['+', 2, 2]], {}),
            7
        );
    });
    // test('a dog and a cat', function() {
    //     assert.deepEqual(
    //         scheem.eval(['+', 'dog', 'cat'], {}),
    //         42
    //     );
    // });
});
suite('subtract', function () {
    test('two numbers', function () {
        assert.deepEqual(
            scheem.eval(['-', 5, 1], {})
            , 4
        );
    });
    test('two expressions', function () {
        assert.deepEqual(
            scheem.eval(['-', ['-', 1, 1], ['-', 1, 0]], {})
            , -1
        );
    });
});
suite('multiplication', function () {
    test('two numbers', function () {
        assert.deepEqual(
            scheem.eval(['*', 3, 4], {})
            , 12
        );
    });
    test('two expressions', function () {
        assert.deepEqual(
            scheem.eval(['*', ['*', 3, 3], ['*', 3, 3]], {})
            , 81
        );
    });
});
suite('division', function () {
    test('two numbers', function () {
        assert.deepEqual(
            scheem.eval(['/', 3, 4], {})
            , 0.75
        );
    });
    test('two expressions', function () {
        assert.deepEqual(
            scheem.eval(['/', ['/', 3, 1], ['/', 9, 3]], {})
            , 1
        );
    });
});
suite('variable', function () {
    test('definition', function () {
        var env = {};
        var result = scheem.eval(['define', 'x', 5], env);
        assert.deepEqual(env, {'x': 5});
        assert.deepEqual(result, 0);
    });
    test('setting', function () {
        var env = {};
        var result = scheem.eval(['set!', 'x', 5], env);
        assert.deepEqual(env, {'x': 5});
        assert.deepEqual(result, 0);
    });
    test('overwriting', function () {
        var env = {'x': 5};
        var result = scheem.eval(['set!', 'x', 10], env);
        assert.deepEqual(env, {'x': 10});
        assert.deepEqual(result, 0);
    });
    test('access', function () {
        var env = {'x': 5};
        var result = scheem.eval(['+', 'x', 'x'], env);
        assert.deepEqual(env, {'x': 5});
        assert.deepEqual(result, 10);
    });
});
suite('blocks', function () {
    test('empty block', function () {
        var env = {};
        var result = scheem.eval(['begin'], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, 0);
    });
    test('single expression block', function () {
        var env = {};
        var result = scheem.eval(['begin', ['+', 1, 2]], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, 3);
    });
    test('multiple expression block', function () {
        var env = {};
        var result = scheem.eval(['begin', ['define', 'x', 5], ['+', 'x', 2]], env);
        assert.deepEqual(env, {'x': 5});
        assert.deepEqual(result, 7);
    });
});
suite('quote', function() {
    test('a number', function() {
        assert.deepEqual(
            scheem.eval(['quote', 3], {}),
            3
        );
    });
    test('an atom', function() {
        assert.deepEqual(
            scheem.eval(['quote', 'dog'], {}),
            'dog'
        );
    });
    test('a list', function() {
        assert.deepEqual(
            scheem.eval(['quote', [1, 2, 3]], {}),
            [1, 2, 3]
        );
    });
});
suite('compare', function () {
    test('equality of 1 and 1', function () {
        var env = {};
        var result = scheem.eval(['=', 1, 1], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, '#t');
    });
    test('inequality of 1 and 2', function () {
        var env = {};
        var result = scheem.eval(['=', 1, 2], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, '#f');
    });
    test('equality of expressions', function () {
        var env = {};
        var result = scheem.eval(['=', ['+', 1, 1], ['/', 16, 8]], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, '#t');
    });
    test('equality of variables', function () {
        var env = {'x': 5, 'y': 5};
        var result = scheem.eval(['=', 'x', 'y'], env);
        assert.deepEqual(env, {'x': 5, 'y': 5});
        assert.deepEqual(result, '#t');
    });
    test('5 is less than 6', function () {
        var env = {};
        var result = scheem.eval(['<', 5, 6], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, '#t');
    });
    test('4 is NOT less than 4', function () {
        var env = {};
        var result = scheem.eval(['<', 4, 4], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, '#f');
    });
    test('variable is less than expression', function () {
        var env = {};
        var result = scheem.eval(['begin', ['define', 'x', -1], ['<', 'x', ['*', 1, 2]]], env);
        assert.deepEqual(env, {'x': -1});
        assert.deepEqual(result, '#t');
    });
});
suite('list manipulation', function () {
    test('get first element', function () {
        var env = {};
        var result = scheem.eval(['car', ['quote', [1, 2, 3]]], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, 1);
    });
    test('get tail', function () {
        var env = {};
        var result = scheem.eval(['cdr', ['quote', [1, 2, 3]]], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, [2, 3]);
    });
    test('concatenate', function () {
        var env = {};
        var result = scheem.eval(['cons', 1, ['quote', [2, 3]]], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, [1, 2, 3]);
    });
    test('cons car cdr', function () {
        var env = {};
        var result = scheem.eval(['begin'
                            , ['define', 'x', ['quote', [1, 2, 3]]]
                            , ['cons', ['car', 'x'], ['cdr', 'x']]
                            ], env);
        assert.deepEqual(env, {'x': [1, 2, 3]});
        assert.deepEqual(result, [1, 2, 3]);
    });
});
suite('conditional', function () {
    test('if true', function () {
        var env = {};
        var result = scheem.eval(['if', ['quote', '#t'], 1, 2], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, 1);
    });
    test('if false', function () {
        var env = {};
        var result = scheem.eval(['if', ['quote', '#f'], 1, 2], env);
        assert.deepEqual(env, {});
        assert.deepEqual(result, 2);
    });
    test('state change when true', function () {
        var env = {};
        var result = scheem.eval(['if', ['=', 1, 1], ['set!', 'x', 1], ['set!', 'y', 2]], env);
        assert.deepEqual(env, {'x': 1});
        assert.deepEqual(result, 0);
    });
    test('state change when false', function () {
        var env = {};
        var result = scheem.eval(['if', ['=', 1, 2], ['set!', 'x', 1], ['set!', 'y', 2]], env);
        assert.deepEqual(env, {'y': 2});
        assert.deepEqual(result, 0);
    });
});

  </script>
  <script>
    $(function(){
      mocha.run();
    });
  </script>
</head>
<body>
  <div id="mocha"></div>
</body>
</html>
